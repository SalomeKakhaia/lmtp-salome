---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# lmtp

<!-- badges: start -->
[![Build Status](https://travis-ci.com/nt-williams/lmtp.svg?token=DA4a53nWMx6q9LisKdRD&branch=master)](https://travis-ci.com/nt-williams/lmtp)
[![codecov](https://codecov.io/gh/nt-williams/lmtp/branch/master/graph/badge.svg?token=TFQNTischL)](https://codecov.io/gh/nt-williams/lmtp)
<!-- badges: end -->

> Non-parametric Causal Effects Based on Longitudinal Modified Treatment Policies

# Installation

The development version can be installed from GitHub with: 

```r
devtools::install_github("nt-williams/lmtp")
```

# Example

```{r}
library(lmtp)
```

A data set with treatment nodes at 4 time points and a binary outcome at time 5.

```{r}
head(sim_t4)
```

We're interested in the effect of an intervention where exposure is decreased by 1 at all time points for observations whose exposure won't go below 0 if shifted on the outcome Y. The true value under this intervention is about 0.48.

```{r}
# Define intervention function, treatment variables, and covariates
d <- function(A) {
  delta <- 1
  return((A - delta) * (A - delta >= 0) + A * (A - delta < 0))
}

a <- c("A_1", "A_2", "A_3", "A_4")
nodes <- list(c("L_1"), c("L_2"), c("L_3"), c("L_4"))
```

Using the TML estimator...

```r
lmtp_tmle(sim_t4, a, "Y", nodes, k = 0, shift = d,
          outcome_type = "binomial",
          learner_stack_Q = sl3::make_learner_stack(sl3::Lrnr_glm, sl3::Lrnr_mean),
          learner_stack_g = sl3::make_learner_stack(sl3::Lrnr_glm, sl3::Lrnr_mean))

#>   Estimating propensity [=====================================] 100%  2s
#>   Estimating regression [=====================================] 100%  1s
#> 
#> Estimator: targeted minimum-loss based
#> 
#> Population intervention effect
#>    Estimate: 0.5172
#>  Std. error: 0.0286
#>      95% CI: (0.4611, 0.5733)
```

Using the SDR estimator...

```r
lmtp_sdr(sim_t4, a, "Y", nodes, k = 0, shift = d,
         outcome_type = "binomial",
         learner_stack_Q = sl3::make_learner_stack(sl3::Lrnr_glm, sl3::Lrnr_mean),
         learner_stack_g = sl3::make_learner_stack(sl3::Lrnr_glm, sl3::Lrnr_mean))

#>   Estimating propensity [=====================================] 100%  2s
#>   Estimating regression [=====================================] 100%  1s
#> 
#> Estimator: sequentially doubly robust
#> 
#> Population intervention effect
#>    Estimate: 0.4948
#>  Std. error: 0.0294
#>      95% CI: (0.4373, 0.5524)
```


